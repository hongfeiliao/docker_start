## notes

避免root访问，还是创建一个user吧。用户：root, admin。

- useradd -m -s /bin/bash admin  (-m是创建家目录，-s是指定shell)
- passwd admin 设置密码

然后给admin配置ssh。

神一样的工具们：

- ssh
- git
- docker 
- mysql8（默认为mysql8.4）


## 回答

User: 怎样配置 ssh 能够不用输入密码（配置密钥）
Kimi: 配置 SSH 密钥可以实现免密登录远程服务器。以下是为本地 Host 上的用户配置 SSH 密钥，从而无需密码登录到远程服务器的详细步骤：

### 1. **生成 SSH 密钥对**
在本地的 Host 上，运行以下命令生成 SSH 密钥对。这里我们以生成 RSA 密钥为例：
```bash
ssh-keygen -t rsa -b 4096 -f ~/.ssh/id_rsa
```
- `-t rsa`：指定生成 RSA 密钥。
- `-b 4096`：指定密钥长度为 4096 位。
- `-f ~/.ssh/id_rsa`：指定私钥文件的保存路径。

生成的密钥对包括：
- 私钥文件：`~/.ssh/id_rsa`
- 公钥文件：`~/.ssh/id_rsa.pub`

**注意：**
如果已经存在文件名冲突或文件存在的问题，系统会提示，你可以选择覆盖或更改文件名。

### 2. **将公钥传输到远程服务器**
将生成的公钥（`id_rsa.pub`）传输到远程服务器的用户 home 目录下的 `~/.ssh/authorized_keys` 文件中。

#### 方法一：使用 `ssh-copy-id`
如果你使用的是 OpenSSH，可以使用 `ssh-copy-id` 命令将公钥传输到远程服务器：
```bash
ssh-copy-id -i ~/.ssh/id_rsa.pub user@remote_host
```
- `user`：远程服务器的用户名。
- `remote_host`：远程服务器的 IP 地址或主机名。

运行此命令后，会提示你输入远程用户密码。验证身份后，公钥会被自动添加到远程服务器的 `~/.ssh/authorized_keys` 文件。

#### 方法二：手动传输公钥
如果你没有 `ssh-copy-id`，可以通过以下步骤手动传输公钥：
1. 使用 `scp` 命令将公钥传输到远程服务器：
   ```bash
   scp ~/.ssh/id_rsa.pub user@remote_host:~/
   ```
2. 登录到远程服务器：
   ```bash
   ssh user@remote_host
   ```
3. 在远程服务器上，创建 `~/.ssh/` 目录（如果不存在）：
   ```bash
   mkdir -p ~/.ssh
   ```
4. 将传输的公钥内容追加到 `~/.ssh/authorized_keys` 文件中：
   ```bash
   cat ~/id_rsa.pub >> ~/.ssh/authorized_keys
   ```
5. 删除传输的临时文件（可选）：
   ```bash
   rm ~/id_rsa.pub
   ```

### 3. **设置正确的文件权限**
在远程服务器上，确保以下文件和目录的权限正确：
1. 设置 `~/.ssh` 目录权限为 `700`：
   ```bash
   chmod 700 ~/.ssh
   ```
2. 设置 `~/.ssh/authorized_keys` 文件权限为 `600`：
   ```bash
   chmod 600 ~/.ssh/authorized_keys
   ```

### 4. **验证 SSH 免密登录**
输入以下命令测试是否可以免密登录远程服务器：
```bash
ssh user@remote_host
```
如果配置成功，你应该能够直接登录，无需输入密码。

### 5. **（可选）禁用密码登录（增加安全性）**
为了进一步提高安全性，你可以禁用远程服务器的密码登录，只允许密钥认证。在远程服务器上，编辑 SSH 配置文件：
```bash
sudo vi /etc/ssh/sshd_config
```
找到以下两个配置项并进行如下修改：
```ini
PubkeyAuthentication yes
PasswordAuthentication no
```
保存并退出编辑器，然后重启 SSH 服务：
```bash
sudo systemctl restart sshd  # 对于基于 systemd 的系统
```

### 总结
- **生成 SSH 密钥对**：可以使用 `ssh-keygen` 工具，生成私钥和公钥文件。
- **传输公钥**：通过 `ssh-copy-id` 或手动传输将公钥添加到远程服务器的 `authorized_keys` 文件。
- **设置权限**：确保 `.ssh` 目录和 `authorized_keys` 文件的权限正确。
- **验证登录**：测试是否可以免密登录远程服务器。

如果你在配置过程中遇到问题，请检查以下几点：
1. 确保远程服务器的 SSH 服务正在运行。
2. 确保本地和远程服务器上的文件权限正确。
3. 确保没有拼写错误或路径错误。

如果还有问题，可以进一步提供详细信息，我会协助你解决问题。
